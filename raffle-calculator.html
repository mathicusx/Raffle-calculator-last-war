<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Last War Raffle Points Calculator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
        }
        
        .input-section {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .list-input {
            flex: 1;
            border: 2px solid #ddd;
            border-radius: 10px;
            padding: 20px;
        }
        
        .list-input h3 {
            color: #007bff;
            margin-bottom: 15px;
        }
        
        .list-input textarea {
            width: 100%;
            height: 400px;
            border: 1px solid #ccc;
            border-radius: 5px;
            padding: 10px;
            font-family: monospace;
            font-size: 14px;
            resize: vertical;
        }
        
        .help-text {
            font-size: 12px;
            color: #666;
            margin-top: 10px;
            line-height: 1.4;
        }
        
        .btn {
            background-color: #007bff;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
        
        .btn:hover {
            background-color: #0056b3;
        }
        
        .btn-clear {
            background-color: #6c757d;
        }
        
        .btn-clear:hover {
            background-color: #545b62;
        }
        
        .controls {
            text-align: center;
            margin: 20px 0;
        }
        
        .results {
            margin-top: 30px;
        }
        
        .results h3 {
            color: #28a745;
            margin-bottom: 20px;
        }
        
        .results-table {
            width: 100%;
            border-collapse: collapse;
            background: #f8f9fa;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .results-table th,
        .results-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        .results-table th {
            background-color: #007bff;
            color: white;
            font-weight: bold;
        }
        
        .results-table tr:hover {
            background-color: #e9ecef;
        }
        
        .rank-1 { background-color: #ffd700 !important; }
        .rank-2 { background-color: #c0c0c0 !important; }
        .rank-3 { background-color: #cd7f32 !important; }
        
        .points-breakdown {
            font-size: 12px;
            color: #666;
        }
        
        .summary {
            margin-top: 20px;
            padding: 15px;
            background-color: #e7f3ff;
            border-radius: 5px;
            border-left: 4px solid #007bff;
        }
        
        .wheel-section {
            margin-top: 30px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 10px;
            text-align: center;
            display: none;
        }
        
        .wheel-container {
            position: relative;
            display: inline-block;
            margin: 20px 0;
        }
        
        .wheel {
            width: 400px;
            height: 400px;
            border-radius: 50%;
            border: 8px solid #333;
            position: relative;
            transition: transform 4s cubic-bezier(0.23, 1, 0.32, 1);
            background: conic-gradient(from 0deg, 
                #ff6b6b 0deg, #4ecdc4 45deg, #45b7d1 90deg, 
                #96ceb4 135deg, #feca57 180deg, #ff9ff3 225deg,
                #54a0ff 270deg, #5f27cd 315deg);
        }
        
        .wheel-pointer {
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 15px solid transparent;
            border-right: 15px solid transparent;
            border-top: 30px solid #333;
            z-index: 10;
        }
        
        .wheel-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
            pointer-events: none;
            z-index: 5;
        }
        
        .wheel-label {
            position: absolute;
            color: white;
            font-weight: bold;
            font-size: 12px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            pointer-events: none;
            transform-origin: center;
            z-index: 6;
            white-space: nowrap;
        }
        
        .spin-btn {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 18px;
            font-weight: bold;
            border-radius: 25px;
            cursor: pointer;
            margin: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .spin-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }
        
        .spin-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .winner-announcement {
            margin: 20px 0;
            padding: 20px;
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            border-radius: 10px;
            border: 3px solid #ff6b6b;
            display: none;
        }
        
        .winner-text {
            font-size: 24px;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }
        
        .winner-points {
            font-size: 16px;
            color: #666;
        }
        
        .winners-history {
            margin-top: 20px;
            text-align: left;
        }
        
        .winner-item {
            padding: 10px;
            margin: 5px 0;
            background: white;
            border-radius: 5px;
            border-left: 4px solid #ffd700;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üèÜ Last War Raffle Points Calculator</h1>
        
        <div class="input-section">
            <div class="list-input">
                <h3>List A Rankings</h3>
                <textarea id="listA" placeholder="Enter player names, one per line:
ViktorBigC√∂ckeres
iMez
XZero
rBaun
BaileyR123
..."></textarea>
                <div class="help-text">
                    Enter player names from the first ranking list, one per line.<br>
                    Order matters: 1st name = 20 points, 2nd name = 19 points, etc.
                </div>
            </div>
            
            <div class="list-input">
                <h3>List B Rankings</h3>
                <textarea id="listB" placeholder="Enter player names, one per line:
SomePlayer
iMez
AnotherPlayer
..."></textarea>
                <div class="help-text">
                    Enter player names from the second ranking list, one per line.<br>
                    Same scoring: 1st name = 20 points, 2nd name = 19 points, etc.
                </div>
            </div>
        </div>
        
        <div class="controls">
            <button class="btn" onclick="calculateRafflePoints()">Calculate Combined Points</button>
            <button class="btn btn-clear" onclick="clearAll()">Clear All</button>
            <button class="btn btn-clear" onclick="loadExample()">Load Example</button>
        </div>
        
        <div class="results" id="results" style="display: none;">
            <h3>Combined Raffle Points Results</h3>
            <table class="results-table">
                <thead>
                    <tr>
                        <th>Final Rank</th>
                        <th>Player Name</th>
                        <th>Total Points</th>
                        <th>Points Breakdown</th>
                    </tr>
                </thead>
                <tbody id="resultsBody">
                </tbody>
            </table>
            
            <div class="summary" id="summary">
            </div>
        </div>
        
    </div>

    <script>
        function calculateRafflePoints() {
            const listAText = document.getElementById('listA').value.trim();
            const listBText = document.getElementById('listB').value.trim();
            
            if (!listAText && !listBText) {
                alert('Please enter at least one list of player names.');
                return;
            }
            
            const listA = listAText ? listAText.split('\n').map(name => name.trim()).filter(name => name) : [];
            const listB = listBText ? listBText.split('\n').map(name => name.trim()).filter(name => name) : [];
            
            
            const playerPoints = {};
            const nameMapping = {};
            
            function normalizeAndMatch(playerName, existingNames) {
                const normalized = playerName.toLowerCase().trim();
                
                for (const existingName of existingNames) {
                    if (normalized === existingName.toLowerCase().trim()) {
                        return existingName;
                    }
                }
                
                return playerName;
            }
            
            listA.forEach((player, index) => {
                const points = Math.max(1, 21 - (index + 1));
                const existingNames = Object.keys(playerPoints);
                const canonicalName = normalizeAndMatch(player, existingNames);
                
                if (!playerPoints[canonicalName]) {
                    playerPoints[canonicalName] = { total: 0, breakdown: [], originalNames: new Set() };
                }
                
                playerPoints[canonicalName].total += points;
                playerPoints[canonicalName].breakdown.push(`List A: #${index + 1} (${points}pts)`);
                playerPoints[canonicalName].originalNames.add(player);
            });
            
            listB.forEach((player, index) => {
                const points = Math.max(1, 21 - (index + 1));
                const existingNames = Object.keys(playerPoints);
                const canonicalName = normalizeAndMatch(player, existingNames);
                
                if (!playerPoints[canonicalName]) {
                    playerPoints[canonicalName] = { total: 0, breakdown: [], originalNames: new Set() };
                }
                
                playerPoints[canonicalName].total += points;
                playerPoints[canonicalName].breakdown.push(`List B: #${index + 1} (${points}pts)`);
                playerPoints[canonicalName].originalNames.add(player);
            });
            
            const sortedResults = Object.entries(playerPoints)
                .map(([name, data]) => ({
                    name: name,
                    total: data.total,
                    breakdown: data.breakdown,
                    originalNames: Array.from(data.originalNames)
                }))
                .sort((a, b) => b.total - a.total);
            
            
            displayResults(sortedResults, listA.length, listB.length);
            
            if (sortedResults.length > 0) {
                showRandomizer(sortedResults);
            }
        }
        
        let rafflePlayers = [];
        let isDrawing = false;
        let drawCount = 0;
        let winners = [];
        
        function showRandomizer(players) {
            rafflePlayers = [...players];
            drawCount = 0;
            
            const randomHTML = `
                <div style="margin-top: 30px; padding: 40px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 20px; text-align: center; box-shadow: 0 20px 40px rgba(0,0,0,0.1);">
                    <h2 style="color: white; margin-bottom: 10px; font-size: 2.5em; text-shadow: 0 2px 4px rgba(0,0,0,0.3);">üé≤ Weighted Random Draw</h2>
                    <p style="color: rgba(255,255,255,0.9); margin-bottom: 30px; font-size: 1.1em;">Higher points = higher chance to win!</p>
                    
                    <div style="max-width: 500px; margin: 0 auto 20px; background: rgba(255,255,255,0.1); border-radius: 12px; padding: 15px;">
                        <h3 style="color: white; margin-bottom: 10px; font-size: 1.1em;">Win Probabilities</h3>
                        <div id="probabilityBars" style="max-height: 200px; overflow-y: auto;">
                            ${createProbabilityBars(players)}
                        </div>
                    </div>
                    
                    <div style="height: 200px; margin: 30px 0; display: flex; align-items: center; justify-content: center;">
                        <div id="drawAnimation" style="display: none; font-size: 4em;">üé≤</div>
                        <div id="drawResult" style="display: none; text-align: center;">
                            <div id="winnerName" style="font-size: 3em; color: #ffd700; font-weight: bold; margin-bottom: 10px;"></div>
                            <div id="winnerInfo" style="font-size: 1.2em; color: rgba(255,255,255,0.9);"></div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 30px;">
                        <button id="drawBtn" onclick="drawWinner()" style="background: linear-gradient(45deg, #ff4757, #ff6b7a); color: white; border: none; padding: 20px 50px; font-size: 24px; font-weight: bold; border-radius: 50px; cursor: pointer; margin: 10px; box-shadow: 0 10px 30px rgba(255, 71, 87, 0.4); transition: all 0.3s ease; text-transform: uppercase; letter-spacing: 2px;">
                            üéØ DRAW WINNER
                        </button>
                        <button onclick="resetDraw()" style="background: rgba(255,255,255,0.2); color: white; border: 2px solid rgba(255,255,255,0.3); padding: 15px 30px; border-radius: 50px; cursor: pointer; margin: 10px; backdrop-filter: blur(10px); transition: all 0.3s ease;">
                            Reset
                        </button>
                    </div>
                    
                    <div id="winnersHistory" style="margin-top: 30px; display: none;">
                        <div style="background: rgba(255,255,255,0.1); border-radius: 15px; padding: 20px; max-width: 600px; margin: 0 auto;">
                            <h3 style="color: white; margin-bottom: 15px; text-align: center;">üèÜ Winners List</h3>
                            <div id="winnersList" style="max-height: 300px; overflow-y: auto;"></div>
                        </div>
                    </div>
                </div>
            `;
            
            document.querySelector('.container').insertAdjacentHTML('beforeend', randomHTML);
        }
        
        function createProbabilityBars(players) {
            const totalPoints = players.reduce((sum, p) => sum + p.total, 0);
            const colors = ['#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FECA57', '#FF9FF3'];
            
            return players.map((player, index) => {
                const probability = ((player.total / totalPoints) * 100).toFixed(1);
                const color = colors[index % colors.length];
                
                return `
                    <div style="display: flex; align-items: center; margin: 8px 0; background: rgba(255,255,255,0.1); border-radius: 10px; padding: 8px;">
                        <div style="flex: 1; text-align: left; color: white; font-weight: bold; min-width: 120px;">${player.name}</div>
                        <div style="flex: 2; margin: 0 10px;">
                            <div style="background: rgba(255,255,255,0.2); height: 20px; border-radius: 10px; overflow: hidden;">
                                <div style="height: 100%; background: ${color}; width: ${probability}%; transition: width 0.5s ease; border-radius: 10px;"></div>
                            </div>
                        </div>
                        <div style="min-width: 80px; text-align: right; color: white; font-weight: bold;">${player.total} pts (${probability}%)</div>
                    </div>
                `;
            }).join('');
        }
        
        function weightedRandomSelect(players) {
            const totalWeight = players.reduce((sum, player) => sum + player.total, 0);
            let random = Math.random() * totalWeight;
            
            
            for (const player of players) {
                random -= player.total;
                if (random <= 0) {
                    return player;
                }
            }
            
            return players[0];
        }
        
        function drawWinner() {
            if (isDrawing || !rafflePlayers || rafflePlayers.length === 0) {
                return;
            }
            
            isDrawing = true;
            const drawBtn = document.getElementById('drawBtn');
            const drawAnimation = document.getElementById('drawAnimation');
            const drawResult = document.getElementById('drawResult');
            
            if (!drawBtn || !drawAnimation || !drawResult) {
                isDrawing = false;
                return;
            }
            
            drawBtn.disabled = true;
            
            drawResult.style.display = 'none';
            drawAnimation.style.display = 'block';
            
            
            let animationCount = 0;
            const animateInterval = setInterval(() => {
                const animations = ['üé≤', 'üé∞', 'üÉè', 'üéØ'];
                drawAnimation.textContent = animations[animationCount % animations.length];
                animationCount++;
            }, 200);
            
            setTimeout(() => {
                try {
                    clearInterval(animateInterval);
                    const winner = weightedRandomSelect(rafflePlayers);
                    showWinner(winner);
                } catch (error) {
                    drawAnimation.textContent = '‚ùå Error';
                }
                
                isDrawing = false;
                drawBtn.disabled = false;
            }, 2000);
        }
        
        function showWinner(winner) {
            drawCount++;
            
            winners.push({
                name: winner.name,
                points: winner.total,
                drawNumber: drawCount,
                winChance: rafflePlayers.length > 0 ? ((winner.total / (rafflePlayers.reduce((sum, p) => sum + p.total, 0) + winner.total)) * 100).toFixed(1) : '100.0'
            });
            
            document.getElementById('drawAnimation').style.display = 'none';
            document.getElementById('drawResult').style.display = 'block';
            document.getElementById('winnerName').textContent = `üèÜ ${winner.name}`;
            
            const totalBefore = rafflePlayers.length > 0 ? rafflePlayers.reduce((sum, p) => sum + p.total, 0) + winner.total : winner.total;
            const winChance = ((winner.total / totalBefore) * 100).toFixed(1);
            document.getElementById('winnerInfo').textContent = `${winner.total} points ‚Ä¢ ${winChance}% chance ‚Ä¢ Draw #${drawCount}`;
            
            rafflePlayers = rafflePlayers.filter(p => p.name !== winner.name);
            
            updateProbabilityBars();
            
            updateWinnersHistory();
            
            if (rafflePlayers.length === 0) {
                document.getElementById('drawBtn').textContent = 'üéâ All Done!';
                document.getElementById('drawBtn').disabled = true;
            } else {
                document.getElementById('drawBtn').textContent = `üéØ Draw #${drawCount + 1}`;
            }
        }
        
        function updateProbabilityBars() {
            if (rafflePlayers.length === 0) {
                document.getElementById('probabilityBars').innerHTML = '<div style="color: white; font-style: italic; text-align: center; padding: 20px;">All players have been drawn!</div>';
                return;
            }
            
            const totalPoints = rafflePlayers.reduce((sum, p) => sum + p.total, 0);
            const colors = ['#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FECA57', '#FF9FF3'];
            
            document.getElementById('probabilityBars').innerHTML = rafflePlayers.map((player, index) => {
                const probability = ((player.total / totalPoints) * 100).toFixed(1);
                const color = colors[index % colors.length];
                
                return `
                    <div style="display: flex; align-items: center; margin: 8px 0; background: rgba(255,255,255,0.1); border-radius: 10px; padding: 8px;">
                        <div style="flex: 1; text-align: left; color: white; font-weight: bold; min-width: 120px;">${player.name}</div>
                        <div style="flex: 2; margin: 0 10px;">
                            <div style="background: rgba(255,255,255,0.2); height: 20px; border-radius: 10px; overflow: hidden;">
                                <div style="height: 100%; background: ${color}; width: ${probability}%; transition: width 0.5s ease; border-radius: 10px;"></div>
                            </div>
                        </div>
                        <div style="min-width: 80px; text-align: right; color: white; font-weight: bold;">${player.total} pts (${probability}%)</div>
                    </div>
                `;
            }).join('');
        }
        
        function updateWinnersHistory() {
            if (winners.length === 0) {
                document.getElementById('winnersHistory').style.display = 'none';
                return;
            }
            
            document.getElementById('winnersHistory').style.display = 'block';
            
            document.getElementById('winnersList').innerHTML = winners.map(winner => `
                <div style="display: flex; align-items: center; margin: 8px 0; background: rgba(255,215,0,0.2); border-radius: 10px; padding: 12px; border: 2px solid #FFD700;">
                    <div style="flex: 0 0 40px; text-align: center; color: #FFD700; font-weight: bold; font-size: 18px;">#${winner.drawNumber}</div>
                    <div style="flex: 1; text-align: left; color: white; font-weight: bold; margin-left: 15px;">${winner.name}</div>
                    <div style="min-width: 120px; text-align: right; color: white; font-weight: bold;">${winner.points} pts (${winner.winChance}%)</div>
                </div>
            `).join('');
        }
        
        function resetDraw() {
            calculateRafflePoints();
            winners = [];
            updateWinnersHistory();
        }
        
        function getSimilarity(str1, str2) {
            const longer = str1.length > str2.length ? str1 : str2;
            const shorter = str1.length > str2.length ? str2 : str1;
            
            if (longer.length === 0) return 1.0;
            
            const editDistance = getEditDistance(longer, shorter);
            return (longer.length - editDistance) / longer.length;
        }
        
        function getEditDistance(str1, str2) {
            const matrix = Array(str2.length + 1).fill(null).map(() => Array(str1.length + 1).fill(null));
            
            for (let i = 0; i <= str1.length; i++) matrix[0][i] = i;
            for (let j = 0; j <= str2.length; j++) matrix[j][0] = j;
            
            for (let j = 1; j <= str2.length; j++) {
                for (let i = 1; i <= str1.length; i++) {
                    const cost = str1[i - 1] === str2[j - 1] ? 0 : 1;
                    matrix[j][i] = Math.min(
                        matrix[j][i - 1] + 1,
                        matrix[j - 1][i] + 1,
                        matrix[j - 1][i - 1] + cost
                    );
                }
            }
            
            return matrix[str2.length][str1.length];
        }
        
        function displayResults(results, listACount, listBCount) {
            const resultsDiv = document.getElementById('results');
            const resultsBody = document.getElementById('resultsBody');
            const summary = document.getElementById('summary');
            
            resultsBody.innerHTML = '';
            
            results.forEach((player, index) => {
                const row = resultsBody.insertRow();
                
                if (index === 0) row.classList.add('rank-1');
                else if (index === 1) row.classList.add('rank-2');
                else if (index === 2) row.classList.add('rank-3');
                
                row.insertCell(0).textContent = `#${index + 1}`;
                
                const nameCell = row.insertCell(1);
                if (player.originalNames && player.originalNames.length > 1) {
                    nameCell.innerHTML = `<strong>${player.name}</strong><br><small style="color: #666;">Also: ${player.originalNames.filter(n => n !== player.name).join(', ')}</small>`;
                } else {
                    nameCell.textContent = player.name;
                }
                
                row.insertCell(2).textContent = `${player.total} points`;
                
                const breakdownCell = row.insertCell(3);
                breakdownCell.innerHTML = player.breakdown.join('<br>');
                breakdownCell.classList.add('points-breakdown');
            });
            
            // Summary
            const totalPlayers = results.length;
            const duplicatePlayers = results.filter(p => p.breakdown.length > 1).length;
            const mergedPlayers = results.filter(p => p.originalNames && p.originalNames.length > 1).length;
            
            summary.innerHTML = `
                <strong>Summary:</strong><br>
                ‚Ä¢ List A: ${listACount} players<br>
                ‚Ä¢ List B: ${listBCount} players<br>
                ‚Ä¢ Total unique players: ${totalPlayers}<br>
                ‚Ä¢ Players in both lists: ${duplicatePlayers}<br>
                ‚Ä¢ Names merged due to similarity: ${mergedPlayers}<br>
                ‚Ä¢ Winner: <strong>${results[0]?.name || 'N/A'}</strong> with ${results[0]?.total || 0} points
            `;
            
            resultsDiv.style.display = 'block';
        }
        
        function clearAll() {
            document.getElementById('listA').value = '';
            document.getElementById('listB').value = '';
            document.getElementById('results').style.display = 'none';
        }
        
        function loadExample() {
            document.getElementById('listA').value = `ViktorBigC√∂ckeres
iMez
XZero
rBaun
BaileyR123
ON MY WAY
Liiisaa
ShadowTheSoul
Lado996
Hiahan`;
            
            document.getElementById('listB').value = `iMez
XZero
ShadowTheSoul
NewPlayer1
NewPlayer2
rBaun
Hiahan
NewPlayer3
BaileyR123
NewPlayer4`;
        }
    </script>
</body>
</html>